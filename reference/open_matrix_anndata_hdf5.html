<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Read/write AnnData matrix — open_matrix_anndata_hdf5 • BPCells</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Read/write AnnData matrix — open_matrix_anndata_hdf5"><meta name="description" content="Read or write a matrix from an anndata hdf5 file. These functions will
automatically transpose matrices when converting to/from the AnnData
format. This is because the AnnData convention stores cells as rows, whereas the R
convention stores cells as columns. If this behavior is undesired, call t()
manually on the matrix inputs and outputs of these functions.
Most users writing to AnnData files should default to write_matrix_anndata_hdf5() rather
than the dense variant (see details for more information)."><meta property="og:description" content="Read or write a matrix from an anndata hdf5 file. These functions will
automatically transpose matrices when converting to/from the AnnData
format. This is because the AnnData convention stores cells as rows, whereas the R
convention stores cells as columns. If this behavior is undesired, call t()
manually on the matrix inputs and outputs of these functions.
Most users writing to AnnData files should default to write_matrix_anndata_hdf5() rather
than the dense variant (see details for more information)."><script defer data-domain="benparks.net" src="https://plausible.benparks.net/js/visit-counts.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.15/dist/katex.min.css" integrity="sha384-Htz9HMhiwV8GuQ28Xr9pEs1B4qJiYu/nYLLwlDklR53QibDfmQzi7rYxXhMH/5/u" crossorigin="anonymous"><!-- The loading of KaTeX is deferred to speed up page rendering --><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.15/dist/katex.min.js" integrity="sha384-bxmi2jLGCvnsEqMuYLKE/KsVCxV3PqmKeK6Y6+lmNXBry6+luFkEOsmp5vD9I/7+" crossorigin="anonymous"></script><!-- To automatically render math in text elements, include the auto-render extension: --><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.15/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BPCells</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pbmc3k.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/pbmc3k.html">Basic tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/benchmarks.html">Performance Benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/how-it-works.html">How BPCells works</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/programming-efficiency.html">Efficiency tips</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../python/index.html"><span class="fa fa-arrow-up-right-from-square"></span> Python Docs</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bnprks/BPCells" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Read/write AnnData matrix</h1>
      <small class="dont-index">Source: <a href="https://github.com/bnprks/BPCells/tree/main/r/R/matrix.R" class="external-link"><code>R/matrix.R</code></a></small>
      <div class="d-none name"><code>open_matrix_anndata_hdf5.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Read or write a matrix from an anndata hdf5 file. These functions will
automatically transpose matrices when converting to/from the AnnData
format. This is because the AnnData convention stores cells as rows, whereas the R
convention stores cells as columns. If this behavior is undesired, call <code><a href="https://rdrr.io/r/base/t.html" class="external-link">t()</a></code>
manually on the matrix inputs and outputs of these functions.</p>
<p>Most users writing to AnnData files should default to <code>write_matrix_anndata_hdf5()</code> rather
than the dense variant (see details for more information).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">open_matrix_anndata_hdf5</span><span class="op">(</span><span class="va">path</span>, group <span class="op">=</span> <span class="st">"X"</span>, buffer_size <span class="op">=</span> <span class="fl">16384L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write_matrix_anndata_hdf5</span><span class="op">(</span></span>
<span>  <span class="va">mat</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"X"</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="fl">16384L</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1024L</span>,</span>
<span>  gzip_level <span class="op">=</span> <span class="fl">0L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write_matrix_anndata_hdf5_dense</span><span class="op">(</span></span>
<span>  <span class="va">mat</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  dataset <span class="op">=</span> <span class="st">"X"</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="fl">16384L</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1024L</span>,</span>
<span>  gzip_level <span class="op">=</span> <span class="fl">0L</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Path to the hdf5 file on disk</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>The group within the hdf5 file to write the data to. If writing
to an existing hdf5 file this group must not already be in use</p></dd>


<dt id="arg-buffer-size">buffer_size<a class="anchor" aria-label="anchor" href="#arg-buffer-size"></a></dt>
<dd><p>For performance tuning only. The number of items to be buffered
in memory before calling writes to disk.</p></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>For performance tuning only. The chunk size used for the HDF5 array storage.</p></dd>


<dt id="arg-gzip-level">gzip_level<a class="anchor" aria-label="anchor" href="#arg-gzip-level"></a></dt>
<dd><p>Gzip compression level. Default is 0 (no compression)</p></dd>


<dt id="arg-dataset">dataset<a class="anchor" aria-label="anchor" href="#arg-dataset"></a></dt>
<dd><p>The dataset within the hdf5 file to write the matrix to. Used for <code>write_matrix_anndata_hdf5_dense</code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>AnnDataMatrixH5 object, with cells as the columns.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Efficiency considerations</strong>: Reading from a dense AnnData matrix will generally be slower
than sparse for single cell datasets, so it is recommended to re-write any dense AnnData
inputs to a sparse format early in processing.</p>
<p><code>write_matrix_anndata_hdf5()</code> should be used by default, as it always writes in the more efficient sparse format.
<code>write_matrix_anndata_hdf5_dense()</code> writes in the AnnData dense format, and can be used for smaller matrices
when efficiency and file size are less of a concern than increased portability (e.g. writing to <code>obsm</code> or <code>varm</code> matrices).
See the <a href="https://anndata.readthedocs.io/en/latest/fileformat-prose.html#dense-arrays" class="external-link">AnnData docs</a> for format details.</p>
<p><strong>Dimension names:</strong> Dimnames are inferred from <code>obs/_index</code> or <code>var/_index</code> based on length matching.
This helps to infer dimnames for <code>obsp</code>,<code> varm</code>, etc. If the number of <code>len(obs) == len(var)</code>,
dimname inference will be disabled.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Create temporary directory to keep demo matrix</span></span></span>
<span class="r-in"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"mat_anndata"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">data_dir</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">data_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">data_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="demo_data.html">get_demo_mat</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## write_matrix_anndata_hdf5() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu">write_matrix_anndata_hdf5</span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="va">mat</span>,</span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"new_demo_mat.h5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3582 x 2600 IterableMatrix object with class AnnDataMatrixH5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Row names: ENSG00000272602, ENSG00000250312 ... ENSG00000255512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Col names: TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data type: uint32_t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage order: column major</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. AnnData HDF5 matrix in file /tmp/RtmpsGFdDm/mat_anndata/new_demo_mat.h5, group X</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## open_matrix_anndata_hdf5() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu">open_matrix_anndata_hdf5</span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"new_demo_mat.h5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3582 x 2600 IterableMatrix object with class AnnDataMatrixH5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Row names: ENSG00000272602, ENSG00000250312 ... ENSG00000255512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Col names: TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data type: uint32_t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage order: column major</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. AnnData HDF5 matrix in file /tmp/RtmpsGFdDm/mat_anndata/new_demo_mat.h5, group X</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## write_matrix_anndata_hdf5_dense() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">mat</span> <span class="op">&lt;-</span> <span class="fu">write_matrix_anndata_hdf5_dense</span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="va">mat</span>,</span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"new_demo_mat_dense.h5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3582 x 2600 IterableMatrix object with class AnnDataMatrixH5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Row names: ENSG00000272602, ENSG00000250312 ... ENSG00000255512</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Col names: TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Data type: uint32_t</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Storage order: column major</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. AnnData HDF5 matrix in file /tmp/RtmpsGFdDm/mat_anndata/new_demo_mat_dense.h5, group X</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Created by Benjamin Parks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>



  <img src="https://plausible.benparks.net/flask-plausible/bpcells-docs.png" style="position:absolute;"></body></html>


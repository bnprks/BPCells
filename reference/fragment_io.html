<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Read/write BPCells fragment objects — write_fragments_memory • BPCells</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Read/write BPCells fragment objects — write_fragments_memory"><meta name="description" content="BPCells fragments can be read/written in compressed (bitpacked) or
uncompressed form in a variety of storage locations: in memory (as an R
object), in an hdf5 file, or in a directory on disk (containing binary
files)."><meta property="og:description" content="BPCells fragments can be read/written in compressed (bitpacked) or
uncompressed form in a variety of storage locations: in memory (as an R
object), in an hdf5 file, or in a directory on disk (containing binary
files)."><script defer data-domain="benparks.net" src="https://plausible.benparks.net/js/visit-counts.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.15/dist/katex.min.css" integrity="sha384-Htz9HMhiwV8GuQ28Xr9pEs1B4qJiYu/nYLLwlDklR53QibDfmQzi7rYxXhMH/5/u" crossorigin="anonymous"><!-- The loading of KaTeX is deferred to speed up page rendering --><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.15/dist/katex.min.js" integrity="sha384-bxmi2jLGCvnsEqMuYLKE/KsVCxV3PqmKeK6Y6+lmNXBry6+luFkEOsmp5vD9I/7+" crossorigin="anonymous"></script><!-- To automatically render math in text elements, include the auto-render extension: --><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.15/dist/contrib/auto-render.min.js" integrity="sha384-hCXGrW6PitJEwbkoStFjeJxv+fSOOQKOPbJxSfM6G5sWZjAyWhXiTIIAmQqnlLlh" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">BPCells</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pbmc3k.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/pbmc3k.html">Basic tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/benchmarks.html">Performance Benchmarks</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/how-it-works.html">How BPCells works</a></li>
    <li><a class="dropdown-item" href="../articles/web-only/programming-efficiency.html">Efficiency tips</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
<li class="nav-item"><a class="nav-link" href="../python/index.html"><span class="fa fa-arrow-up-right-from-square"></span> Python Docs</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/bnprks/BPCells" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Read/write BPCells fragment objects</h1>
      <small class="dont-index">Source: <a href="https://github.com/bnprks/BPCells/tree/main/r/R/fragments.R" class="external-link"><code>R/fragments.R</code></a></small>
      <div class="d-none name"><code>fragment_io.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>BPCells fragments can be read/written in compressed (bitpacked) or
uncompressed form in a variety of storage locations: in memory (as an R
object), in an hdf5 file, or in a directory on disk (containing binary
files).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">write_fragments_memory</span><span class="op">(</span><span class="va">fragments</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write_fragments_dir</span><span class="op">(</span></span>
<span>  <span class="va">fragments</span>,</span>
<span>  <span class="va">dir</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="fl">1024L</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">open_fragments_dir</span><span class="op">(</span><span class="va">dir</span>, buffer_size <span class="op">=</span> <span class="fl">1024L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write_fragments_hdf5</span><span class="op">(</span></span>
<span>  <span class="va">fragments</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  group <span class="op">=</span> <span class="st">"fragments"</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="fl">8192L</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1024L</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  gzip_level <span class="op">=</span> <span class="fl">0L</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">open_fragments_hdf5</span><span class="op">(</span><span class="va">path</span>, group <span class="op">=</span> <span class="st">"fragments"</span>, buffer_size <span class="op">=</span> <span class="fl">16384L</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-fragments">fragments<a class="anchor" aria-label="anchor" href="#arg-fragments"></a></dt>
<dd><p>Input fragments object</p></dd>


<dt id="arg-compress">compress<a class="anchor" aria-label="anchor" href="#arg-compress"></a></dt>
<dd><p>Whether or not to compress the data. With compression, storage size is
be about half the size of a gzip-compressed 10x fragments file.</p></dd>


<dt id="arg-dir">dir<a class="anchor" aria-label="anchor" href="#arg-dir"></a></dt>
<dd><p>Directory to read/write the data from</p></dd>


<dt id="arg-buffer-size">buffer_size<a class="anchor" aria-label="anchor" href="#arg-buffer-size"></a></dt>
<dd><p>For performance tuning only. The number of items to be bufferred
in memory before calling writes to disk.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>If <code>TRUE</code>, write to a temp dir then overwrite existing data. Alternatively,
pass a temp path as a string to customize the temp dir location.</p></dd>


<dt id="arg-path">path<a class="anchor" aria-label="anchor" href="#arg-path"></a></dt>
<dd><p>Path to the hdf5 file on disk</p></dd>


<dt id="arg-group">group<a class="anchor" aria-label="anchor" href="#arg-group"></a></dt>
<dd><p>The group within the hdf5 file to write the data to. If writing
to an existing hdf5 file this group must not already be in use</p></dd>


<dt id="arg-chunk-size">chunk_size<a class="anchor" aria-label="anchor" href="#arg-chunk-size"></a></dt>
<dd><p>For performance tuning only. The chunk size used for the HDF5 array storage.</p></dd>


<dt id="arg-gzip-level">gzip_level<a class="anchor" aria-label="anchor" href="#arg-gzip-level"></a></dt>
<dd><p>Gzip compression level. Default is 0 (no compression). This is recommended when both compression and
compatibility with outside programs is required. Otherwise, using compress=TRUE is recommended
as it is &gt;10x faster with often similar compression levels.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Fragment object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Saving in a directory on disk is a good default for local analysis, as it
provides the best I/O performance and lowest memory usage. The HDF5 format
allows saving within existing hdf5 files to group data together, and the in
memory format provides the fastest performance in the event memory usage is
unimportant.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Create temporary directory to keep demo fragments</span></span></span>
<span class="r-in"><span><span class="va">data_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"frags"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">data_dir</span>, recursive <span class="op">=</span> <span class="cn">TRUE</span>, showWarnings <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## Get demo frags loaded from disk</span></span></span>
<span class="r-in"><span><span class="va">frags</span> <span class="op">&lt;-</span> <span class="fu"><a href="demo_data.html">get_demo_frags</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frags</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IterableFragments object of class "FragmentsDir"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cells: 2600 cells with names TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chromosomes: 2 chromosomes with names chr4, chr11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Read compressed fragments from directory /home/imman/.local/share/R/BPCells/demo_data/demo_frags_filtered_subsetted</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## write_fragments_memory() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">frags_memory</span> <span class="op">&lt;-</span> <span class="fu">write_fragments_memory</span><span class="op">(</span><span class="va">frags</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frags_memory</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IterableFragments object of class "PackedMemFragments"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cells: 2600 cells with names TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chromosomes: 2 chromosomes with names chr4, chr11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Read compressed fragments from memory</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## write_fragments_dir() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">frags</span> <span class="op">&lt;-</span> <span class="fu">write_fragments_dir</span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="va">frags_memory</span>, </span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"demo_frags"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> overwrite <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frags</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IterableFragments object of class "FragmentsDir"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cells: 2600 cells with names TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chromosomes: 2 chromosomes with names chr4, chr11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Read compressed fragments from directory /tmp/RtmpCiGY9C/frags/demo_frags</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## open_fragments_dir() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">frags</span> <span class="op">&lt;-</span> <span class="fu">open_fragments_dir</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"demo_frags"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frags</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IterableFragments object of class "FragmentsDir"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cells: 2600 cells with names TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chromosomes: 2 chromosomes with names chr4, chr11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Read compressed fragments from directory /tmp/RtmpCiGY9C/frags/demo_frags</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## write_fragments_hdf5() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">frags_hdf5</span> <span class="op">&lt;-</span> <span class="fu">write_fragments_hdf5</span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="va">frags</span>, </span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"demo_frags.h5"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span> overwrite <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frags_hdf5</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IterableFragments object of class "FragmentsHDF5"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cells: 2600 cells with names TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chromosomes: 2 chromosomes with names chr4, chr11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Read compressed fragments from /tmp/RtmpCiGY9C/frags/demo_frags.h5, group fragments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="co">## open_fragments_hdf5() example</span></span></span>
<span class="r-in"><span><span class="co">#######################################################################</span></span></span>
<span class="r-in"><span><span class="va">frags_hdf5</span> <span class="op">&lt;-</span> <span class="fu">open_fragments_hdf5</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">data_dir</span>, <span class="st">"demo_frags.h5"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">frags_hdf5</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> IterableFragments object of class "FragmentsHDF5"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Cells: 2600 cells with names TTTAGCAAGGTAGCTT-1, AGCCGGTTCCGGAACC-1 ... TACTAAGTCCAATAGC-1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Chromosomes: 2 chromosomes with names chr4, chr11</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Queued Operations:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1. Read compressed fragments from /tmp/RtmpCiGY9C/frags/demo_frags.h5, group fragments</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Created by Benjamin Parks.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>



  <img src="https://plausible.benparks.net/flask-plausible/bpcells-docs.png" style="position:absolute;"></body></html>


<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="BPCells matrices are stored in sparse format, meaning only the non-zero entries
are stored. Matrices can store integer counts data or decimal numbers (float or double).
See details for more information."><title>Read/write sparse matrices — write_matrix_memory • BPCells</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Read/write sparse matrices — write_matrix_memory"><meta property="og:description" content="BPCells matrices are stored in sparse format, meaning only the non-zero entries
are stored. Matrices can store integer counts data or decimal numbers (float or double).
See details for more information."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="benparks.net" src="https://plausible.benparks.net/js/visit-counts.js"></script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">BPCells</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/pbmc3k.html">Get Started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/pbmc3k.html">Basic tutorial</a>
    <a class="dropdown-item" href="../articles/web-only/benchmarks.html">Performance Benchmarks</a>
    <a class="dropdown-item" href="../articles/web-only/how-it-works.html">How BPCells works</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/index.html">More articles...</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/bnprks/BPCells/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Read/write sparse matrices</h1>
      <small class="dont-index">Source: <a href="https://github.com/bnprks/BPCells/blob/HEAD/R/matrix.R" class="external-link"><code>R/matrix.R</code></a></small>
      <div class="d-none name"><code>matrix_io.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>BPCells matrices are stored in sparse format, meaning only the non-zero entries
are stored. Matrices can store integer counts data or decimal numbers (float or double).
See details for more information.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">write_matrix_memory</span><span class="op">(</span><span class="va">mat</span>, compress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write_matrix_dir</span><span class="op">(</span></span>
<span>  <span class="va">mat</span>,</span>
<span>  <span class="va">dir</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="fl">8192L</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">open_matrix_dir</span><span class="op">(</span><span class="va">dir</span>, buffer_size <span class="op">=</span> <span class="fl">8192L</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">write_matrix_hdf5</span><span class="op">(</span></span>
<span>  <span class="va">mat</span>,</span>
<span>  <span class="va">path</span>,</span>
<span>  <span class="va">group</span>,</span>
<span>  compress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  buffer_size <span class="op">=</span> <span class="fl">8192L</span>,</span>
<span>  chunk_size <span class="op">=</span> <span class="fl">1024L</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">open_matrix_hdf5</span><span class="op">(</span><span class="va">path</span>, <span class="va">group</span>, buffer_size <span class="op">=</span> <span class="fl">16384L</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>compress</dt>
<dd><p>Whether or not to compress the data.</p></dd>


<dt>dir</dt>
<dd><p>Directory to save the data into</p></dd>


<dt>buffer_size</dt>
<dd><p>For performance tuning only. The number of items to be buffered
in memory before calling writes to disk.</p></dd>


<dt>overwrite</dt>
<dd><p>If <code>TRUE</code>, write to a temp dir then overwrite existing data. Alternatively,
pass a temp path as a string to customize the temp dir location.</p></dd>


<dt>path</dt>
<dd><p>Path to the hdf5 file on disk</p></dd>


<dt>group</dt>
<dd><p>The group within the hdf5 file to write the data to. If writing
to an existing hdf5 file this group must not already be in use</p></dd>


<dt>chunk_size</dt>
<dd><p>For performance tuning only. The chunk size used for the HDF5 array storage.</p></dd>


<dt>matrix</dt>
<dd><p>Input matrix, either IterableMatrix or dgCMatrix</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>BPCells matrix object</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    
<div class="section">
<h3 id="storage-locations">Storage locations<a class="anchor" aria-label="anchor" href="#storage-locations"></a></h3>


<p>Matrices can be stored in a directory on disk, in memory, or in an HDF5 file.
Saving in a directory on disk is a good default for local analysis, as it provides
the best I/O performance and lowest memory usage. The HDF5 format
allows saving within existing hdf5 files to group data together, and the in
memory format provides the fastest performance in the event memory usage is
unimportant.</p>
</div>

<div class="section">
<h3 id="bitpacking-compression">Bitpacking Compression<a class="anchor" aria-label="anchor" href="#bitpacking-compression"></a></h3>


<p>For typical RNA counts matrices holding integer counts, this bitpacking
compression will result in 6-8x less space than an R dgCMatrix, and 4-6x
smaller than a scipy csc_matrix. The compression will be more effective when
the count values in the matrix are small, and when the rows of the matrix are
sorted by rowMeans. In tests on RNA-seq data optimal ordering could save up
to 40% of storage space. On non-integer data only the row indices are
compressed, not the values themselves so space savings will be smaller.</p>
<p>For non-integer data matrices, bitpacking compression is much less effective,
as it can only be applied to the indexes of each entry but not the values.
There will still be some space savings, but far less than for counts matrices.</p>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Benjamin Parks.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  <img src="https://plausible.benparks.net/flask-plausible/bpcells-docs.png" style="position:absolute;"></body></html>

